{"version":3,"file":"webservice_config.min.js","sources":["../src/webservice_config.js"],"sourcesContent":["// This file is part of Moodle - https://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * AMD module to handle the Webservice configuration actions for Datacurso.\n * It performs setup, token regeneration, and registration calls and\n * displays progress via UI notifications and a simple log list.\n *\n * @module      aiprovider_datacurso/webservice_config\n * @copyright   2025 Wilber Narvaez <wilber@buendata.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport { get_string } from 'core/str';\n\nconst log = (msg, type = 'info') => {\n    const list = document.getElementById('dc-ws-log');\n    if (!list) {\n        return;\n    }\n    const li = document.createElement('li');\n    li.textContent = msg;\n    li.classList.add('mb-1');\n    if (type === 'success') {\n        li.classList.add('text-success');\n    } else if (type === 'error') {\n        li.classList.add('text-danger');\n    } else {\n        li.classList.add('text-muted');\n    }\n    list.appendChild(li);\n};\n\nconst call = (methodname) => {\n    return Ajax.call([{\n        methodname,\n        args: {}\n    }])[0];\n};\n\nconst handleAction = async(action) => {\n    try {\n        let methodname;\n        if (action === 'setup') {\n            methodname = 'aiprovider_datacurso_webservice_setup';\n            const message = await get_string('ws_step_setup', 'aiprovider_datacurso');\n            log(message);\n        } else if (action === 'regenerate') {\n            methodname = 'aiprovider_datacurso_webservice_regenerate_token';\n            const message = await get_string('ws_step_token_regenerating', 'aiprovider_datacurso');\n            log(message);\n        } else if (action === 'retry') {\n            methodname = 'aiprovider_datacurso_webservice_setup';\n            const message = await get_string('ws_step_token_retry', 'aiprovider_datacurso');\n            log(message);\n        } else {\n            return;\n        }\n\n        const res = await call(methodname);\n        if (res.messages && Array.isArray(res.messages)) {\n            res.messages.forEach(m => log(m));\n        }\n        Notification.addNotification({\n            message: 'Done: ' + action,\n            type: 'success'\n        });\n    } catch (e) {\n        Notification.exception(e);\n        log('Error: ' + (e.message || e), 'error');\n    }\n};\n\nexport const init = () => {\n    const container = document.querySelector('.aiprovider-datacurso-webservice');\n    if (!container) {\n        return;\n    }\n    container.addEventListener('click', (ev) => {\n        const btn = ev.target.closest('button[data-action]');\n        if (!btn) {\n            return;\n        }\n        ev.preventDefault();\n        const action = btn.getAttribute('data-action');\n        handleAction(action);\n    });\n};\n\nexport default {init};\n"],"names":["log","msg","type","list","document","getElementById","li","createElement","textContent","classList","add","appendChild","handleAction","async","methodname","action","message","res","Ajax","call","args","messages","Array","isArray","forEach","m","addNotification","e","exception","init","container","querySelector","addEventListener","ev","btn","target","closest","preventDefault","getAttribute"],"mappings":";;;;;;;;;iMA6BMA,IAAM,SAACC,SAAKC,4DAAO,aACfC,KAAOC,SAASC,eAAe,iBAChCF,kBAGCG,GAAKF,SAASG,cAAc,MAClCD,GAAGE,YAAcP,IACjBK,GAAGG,UAAUC,IAAI,QACJ,YAATR,KACAI,GAAGG,UAAUC,IAAI,gBACD,UAATR,KACPI,GAAGG,UAAUC,IAAI,eAEjBJ,GAAGG,UAAUC,IAAI,cAErBP,KAAKQ,YAAYL,KAUfM,aAAeC,MAAAA,iBAETC,cACW,UAAXC,OAAoB,CACpBD,WAAa,8CACPE,cAAgB,mBAAW,gBAAiB,wBAClDhB,IAAIgB,cACD,GAAe,eAAXD,OAAyB,CAChCD,WAAa,yDACPE,cAAgB,mBAAW,6BAA8B,wBAC/DhB,IAAIgB,aACD,CAAA,GAAe,UAAXD,cAAoB,CAC3BD,WAAa,8CACPE,cAAgB,mBAAW,sBAAuB,wBACxDhB,IAAIgB,gBAKFC,SA1BAH,CAAAA,YACHI,cAAKC,KAAK,CAAC,CACdL,WAAAA,WACAM,KAAM,MACN,GAsBkBD,CAAKL,YACnBG,IAAII,UAAYC,MAAMC,QAAQN,IAAII,WAClCJ,IAAII,SAASG,SAAQC,GAAKzB,IAAIyB,2BAErBC,gBAAgB,CACzBV,QAAS,SAAWD,OACpBb,KAAM,YAEZ,MAAOyB,yBACQC,UAAUD,GACvB3B,IAAI,WAAa2B,EAAEX,SAAWW,GAAI,WAI7BE,KAAO,WACVC,UAAY1B,SAAS2B,cAAc,oCACpCD,WAGLA,UAAUE,iBAAiB,SAAUC,WAC3BC,IAAMD,GAAGE,OAAOC,QAAQ,2BACzBF,WAGLD,GAAGI,uBACGtB,OAASmB,IAAII,aAAa,eAChC1B,aAAaG,4CAIN,CAACc,KAAAA"}