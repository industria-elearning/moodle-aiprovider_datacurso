define("aiprovider_datacurso/consumption",["exports","core/ajax","core/str","core/templates"],(function(_exports,_ajax,_str,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Consumption history table management.
   *
   * @module     aiprovider_datacurso/consumption
   * @copyright  2025 Industria Elearning
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates);_exports.init=async()=>{const page=await(0,_str.get_string)("page","core"),of=await(0,_str.get_string)("of","aiprovider_datacurso"),registers=await(0,_str.get_string)("registers","aiprovider_datacurso"),tableBody=document.getElementById("consumption-table-body"),filterService=document.getElementById("filter-service"),filterAction=document.getElementById("filter-action"),filterFrom=document.getElementById("filter-date-from"),filterTo=document.getElementById("filter-date-to"),prevPageBtn=document.getElementById("prev-page"),nextPageBtn=document.getElementById("next-page"),pageInfo=document.getElementById("page-info");let currentSortField="",currentSortDir="asc";const limitSelect=document.getElementById("filter-limit"),pageInput=document.getElementById("filter-page");let currentPage=parseInt(sessionStorage.getItem("consumptionPage"))||1,currentLimit=parseInt(sessionStorage.getItem("consumptionLimit"))||10;const savePage=page=>sessionStorage.setItem("consumptionPage",page),fetchData=()=>{const serviceValue=filterService.value,actionValue=filterAction.value,fromValue=filterFrom.value,toValue=filterTo.value,args={page:currentPage,limit:currentLimit,service:"all"!==serviceValue?serviceValue:"",action:"all"!==actionValue?actionValue:"",fromdate:fromValue||"",todate:toValue||""};currentSortField&&(args.shor=currentSortField,args.shordir=currentSortDir),_ajax.default.call([{methodname:"aiprovider_datacurso_get_consumption_history",args:args}])[0].then((response=>{(async listconsumptions=>{const tableBody=document.getElementById("consumption-table-body");try{if(!listconsumptions||0===listconsumptions.length){const nodata=await _templates.default.render("aiprovider_datacurso/consumption_nodata",{});return void(tableBody.innerHTML=nodata)}const context={consumptions:listconsumptions},html=await _templates.default.render("aiprovider_datacurso/consumption_row",context);tableBody.innerHTML=html}catch(error){console.error("Error rendering table:",error,error.stack);const nodata=await _templates.default.render("aiprovider_datacurso/consumption_nodata",{});tableBody.innerHTML=nodata}})((null==response?void 0:response.consumption)||[]);const pagination=null==response?void 0:response.pagination;if(pagination){const{current_page:current_page,total_pages:total_pages,total:total}=pagination;pageInfo.textContent="".concat(page," ").concat(current_page," ").concat(of," ").concat(total_pages," (").concat(total," ").concat(registers,")"),pageInput&&(pageInput.value=current_page),prevPageBtn.disabled=current_page<=1,nextPageBtn.disabled=current_page>=total_pages}else pageInfo.textContent="",prevPageBtn.disabled=!0,nextPageBtn.disabled=!0})).catch((async e=>{const nodata=await _templates.default.render("aiprovider_datacurso/consumption_nodata",{});tableBody.innerHTML=nodata,console.error("Error fetching data:",e)}))};[filterService,filterAction,filterFrom,filterTo].forEach((el=>{el.addEventListener("change",(()=>{currentPage=1,savePage(currentPage),fetchData()}))})),prevPageBtn.addEventListener("click",(()=>{currentPage>1&&(currentPage--,savePage(currentPage),fetchData())})),nextPageBtn.addEventListener("click",(()=>{currentPage++,savePage(currentPage),fetchData()})),limitSelect&&(limitSelect.value=currentLimit,limitSelect.addEventListener("change",(()=>{var limit;currentLimit=parseInt(limitSelect.value),limit=currentLimit,sessionStorage.setItem("consumptionLimit",limit),currentPage=1,savePage(currentPage),fetchData()}))),pageInput&&pageInput.addEventListener("change",(()=>{const newPage=parseInt(pageInput.value);newPage&&newPage>0&&(currentPage=newPage,savePage(currentPage),fetchData())})),document.querySelectorAll(".sortable").forEach((header=>{header.addEventListener("click",(()=>{const field=header.dataset.sort,icon=header.querySelector(".sort-icon");currentSortField===field?currentSortDir="asc"===currentSortDir?"desc":"asc":(currentSortField=field,currentSortDir="asc"),document.querySelectorAll(".sort-icon").forEach((i=>{i.className="fa fa-sort sort-icon"})),icon.className="asc"===currentSortDir?"fa fa-sort-up sort-icon":"fa fa-sort-down sort-icon",currentPage=1,savePage(currentPage),fetchData()}))})),Promise.all([(async()=>{try{var _response$services;const response=await _ajax.default.call([{methodname:"aiprovider_datacurso_get_services",args:{}}])[0];null!=response&&null!==(_response$services=response.services)&&void 0!==_response$services&&_response$services.length&&response.services.forEach((s=>{const opt=document.createElement("option");opt.value=s.name,opt.textContent=s.name,filterService.appendChild(opt)}))}catch(error){console.error("Error loading services:",error)}})(),(async()=>{try{var _response$actions;const response=await _ajax.default.call([{methodname:"aiprovider_datacurso_get_actions",args:{}}])[0];null!=response&&null!==(_response$actions=response.actions)&&void 0!==_response$actions&&_response$actions.length&&response.actions.forEach((a=>{const opt=document.createElement("option");opt.value=a.id,opt.textContent=a.name,filterAction.appendChild(opt)}))}catch(error){console.error("Error loading actions:",error)}})()]).then((()=>fetchData())).catch((e=>console.error("Error in initial load:",e)))}}));

//# sourceMappingURL=consumption.min.js.map