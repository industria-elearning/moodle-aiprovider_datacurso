define("aiprovider_datacurso/consumption",["exports","core/ajax","core/str"],(function(_exports,_ajax,_str){var obj;
/**
   * TODO describe module consumption
   *
   * @module     aiprovider_datacurso/consumption
   * @copyright  2025 Industria Elearning <info@industriaelearning.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=(obj=_ajax)&&obj.__esModule?obj:{default:obj};_exports.init=()=>{console.log("history consume");const tableBody=document.getElementById("consumption-table-body"),filterService=document.getElementById("filter-service"),filterAction=document.getElementById("filter-action"),prevPageBtn=document.getElementById("prev-page"),nextPageBtn=document.getElementById("next-page"),pageInfo=document.getElementById("page-info");let allConsumos=[],filteredConsumos=[],currentPage=1;const renderTable=()=>{if(tableBody.innerHTML="",0===filteredConsumos.length)return(0,_str.get_string)("nodata","aiprovider_datacurso").then((nodata=>{tableBody.innerHTML='<tr><td colspan="7">'.concat(nodata,"</td></tr>")})),pageInfo.textContent="",prevPageBtn.disabled=!0,void(nextPageBtn.disabled=!0);const start=10*(currentPage-1),end=start+10;filteredConsumos.slice(start,end).forEach((item=>{const row=document.createElement("tr");row.innerHTML="\n                <td>".concat(item.id_consumo,"</td>\n                <td>").concat(item.id_usuario,"</td>\n                <td>").concat(item.accion,"</td>\n                <td>").concat(item.servicio,"</td>\n                <td>").concat(item.cantidad_tokens,"</td>\n                <td>").concat(item.saldo_restante,"</td>\n                <td>").concat(item.fecha,"</td>\n            "),tableBody.appendChild(row)}));const totalPages=Math.ceil(filteredConsumos.length/10);pageInfo.textContent="PÃ¡gina ".concat(currentPage," de ").concat(totalPages),prevPageBtn.disabled=1===currentPage,nextPageBtn.disabled=currentPage===totalPages},applyFilters=()=>{const serviceValue=filterService.value,actionValue=filterAction.value;filteredConsumos=allConsumos.filter((item=>{const serviceMatch="all"===serviceValue||item.servicio===serviceValue,actionMatch="all"===actionValue||item.accion===actionValue;return serviceMatch&&actionMatch})),currentPage=1,renderTable()};_ajax.default.call([{methodname:"aiprovider_datacurso_get_consumption_history",args:{}}])[0].then((async response=>{allConsumos=(null==response?void 0:response.consumos)||[];const uniqueServices=[...new Set(allConsumos.map((c=>c.servicio)))],uniqueActions=[...new Set(allConsumos.map((c=>c.accion)))];uniqueServices.forEach((s=>{const opt=document.createElement("option");opt.value=s,opt.textContent=s,filterService.appendChild(opt)})),uniqueActions.forEach((a=>{const opt=document.createElement("option");opt.value=a,opt.textContent=a,filterAction.appendChild(opt)})),filterService.addEventListener("change",applyFilters),filterAction.addEventListener("change",applyFilters),prevPageBtn.addEventListener("click",(()=>{currentPage>1&&(currentPage--,renderTable())})),nextPageBtn.addEventListener("click",(()=>{const totalPages=Math.ceil(filteredConsumos.length/10);currentPage<totalPages&&(currentPage++,renderTable())})),filteredConsumos=allConsumos,renderTable()})).catch((async error=>{const nodata=await(0,_str.get_string)("nodata","aiprovider_datacurso");tableBody.innerHTML='<tr><td colspan="7">'.concat(nodata,"</td></tr>")}))}}));

//# sourceMappingURL=consumption.min.js.map